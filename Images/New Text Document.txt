let offset = 0; 
let limit = 10; 
let check = false;
let num = 0;
let gifNum = 0;
let isLoading = false;
let Div = document.createElement("div");
Div.id = "GIFS";
let showDiv = document.getElementById('gifs');
let gifs = [];

let div2 = document.createElement('div');
div2.id = "searchName";
Div.appendChild(div2);

search = document.createElement('input');
search.type = "text";
search.id="searchGifs";
div2.appendChild(search);

async function fetchData() {
    try {
        isLoading = true;
        const response = await fetch(`https://api.giphy.com/v1/gifs/trending?api_key=oP73qkuaWZ6xB54SbHLWoNjVKVz25gab&limit=${limit}&offset=${offset}`);
        const data = await response.json();
        gifs = data.data;
        offset += gifs.length;
        isLoading = false;
    } catch (error) {
        console.error('Error fetching GIFs:', error);
        isLoading = false;
    }
}

async function fetchMoreGIFs() {
    if (isLoading) return;
    isLoading = true;
    try {
        const response = await fetch(`https://api.giphy.com/v1/gifs/trending?api_key=oP73qkuaWZ6xB54SbHLWoNjVKVz25gab&limit=${limit}&offset=${offset}`);
        const data = await response.json();
        const newGIFs = data.data;
        gifs.push(newGIFs);
        offset += newGIFs.length; 
        insertToDiv(newGIFs);
        isLoading = false;
    } catch (error) {
        console.error('Error fetching more GIFs:', error);
        isLoading = false;
    }
}

fetchData();

function insertToDiv(array) {
    for (let i = 0; i < array.length; i++) {
        const src = document.createElement('img');
        src.src = `${array[i].images.downsized.url}`;
        src.title = `${array[i].username}`;
        src.classList.add("gif");
        src.style.width = "30vw";
        src.style.height = "30vh";
        Div.appendChild(src);
    }
}

async function showGifs() {
    if (check == false) {
        await fetchData();
        if (gifNum == 0) {
            insertToDiv(gifs);
            gifNum++;
        }
        if (num == 0) {
            showDiv.appendChild(Div);
            num++;
        } else {
            Div.style.display = "block";
        }
        check = true;
    }
}

function hiddenDiv() {
    function handleClickOutside(event) {
        let clicked = event.target;
        if (clicked.id == 'i1' || clicked.id == 'i2' || clicked.id == 'i3' || clicked.id == "GIFS" || clicked.classList.contains("gif") || clicked.id == "searchName" || clicked.id == "searchGifs") {} else {
            if (check == true) {
                Div.style.display = "none";
                check = false;
            }
        }
    }

    document.body.addEventListener('click', handleClickOutside);
}

Div.addEventListener('scroll', function() {
    if (Div.scrollTop + Div.clientHeight >= Div.scrollHeight) {
        fetchMoreGIFs();
    }
});
